# 동기화

---

## 동기화?
- 한정적인 시스템 자원에 여러 스레드가 동시에 접근해서 사용하면 문제가 발생할 수 있다.
- 이 문제를 방지하기 위해 여러 스레드에게 하나의 자원에 대한 처리 권한을 주거나 순서를 조정하는 기법이다.

## 스레드 동기화
- 실행 순서의 동기화
  - 스레드의 실행 순서를 정의하고, 이 순서를 반드시 따르도록 하는 것.
- 메모리 접근에 대한 동기화
  - 실행 순서가 중요한 것이 아니라 한 순간에 하나의 스레드만 해당 자원에 접근하도록 하는 것.

## 동기화 기법

### 1. 유저 모드의 동기화
- 커널의 힘을 빌리지 않는 동기화 기법
- 성능상 이점이 있으나, 기능상의 제한점이 존재

`임계 구역 기반의 동기화`
- `임계 구역(Critical Section)` 집입을 위해 `크리티컬 섹션 오브젝트`를 얻는다.
- 열쇠를 얻은 프로세스만 임계 구역에 들어갈 수 있다. 한번에 하나의 스레드만이 접근 가능하다.
- 다른 스레드가 열쇠를 가지고 있을 시에는 반환할 때까지 블로킹된다.
- 열쇠가 반환되면 블로킹 상태에서 빠져나와 열쇠를 얻고 임계 구역에 접근한다.

`인터락 함수 기반의 동기화`
- 인터락 함수: 함수 내부적으로 한 순간에 하나의 쓰레드에 의해서만 실행
- 임계 구역 기반의 동기화도 내부적으로 인터락 함수를 기반으로 구현된다.
- 유저 모드 기반으로 동작해서 속도가 빠르다.

### 2. 커널모드의 동기화

#### 2-1. 세마포어(Semaphore)
- 공유된 자원의 데이터를 여러 프로세스, 스레드가 접근하는 것을 막는 것이다.
- 동시에 접근할 수 있는 '허용 가능한 갯수'를 가지고 있는 Counter
  - 공유자원에 접근할 수 있는 스레드 혹은 프로세스의 수를 나타내는 값 -> 공통으로 관리하는 하나의 값
- 세마포어 Counter의 갯수에 따라 다음과 같이 나뉜다.
  - 1개: Binary Semaphore(뮤텍스와 같다.)
  - 2개 이상: Counting Semaphore
- 세마포어는 소유할 수 없다.
  - 세마포어를 소유하지 않는 스레드가 세마포어를 해제할 수 있는 문제가 발생한다.

#### 2-2. 뮤텍스(Mutal Exclusion)
- 공유된 자원의 데이터를 여러 프로세스, 스레드가 접근하는 것을 막는 것이다.
- 임계 구역을 가진 스레드들의 Running time이 서로 겹치지 않게 각각 단독으로 실행되게 하는 기술
- 뮤텍스 객체를 두 스레드가 동시에 사용할 수 없다.
- 일종의 Locking 메커니즘으로 공유 자원에 대한 접근을 조율하기 위해 locking과 unlocking을 사용
- Lock에 대한 소유권이 있으며 Lock을 가지고 있을 경우에만 공유 자원에 접근할 수 있고, Lock을 가진 사람만 반납할 수 있다.

ex) 뮤텍스는 무조건 1개의 열쇠만 가질수 있다. 열쇠를 가진 사람만이 화장실에 갈 수 있고, 다음 사람이 화장실을 가기 위해서는 앞 사람이 열쇠를 반납해야 한다.
