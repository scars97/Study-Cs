# 메모리 관리 (다시보기)

---

메모리는 CPU가 실행할 프로그램 코드와 데이터를 저장하는 물리 장치.
- CPU 레지스터, 캐시 메모리, 메인 메모리, 보조 기억 장치 등을 읽고 쓰는 속도와 용량에 따라 메모리 계층 구조를 이룬다.

## 메인 메모리 (주기억장치,RAM)
- CPU가 직접 접근하는 기억 장치이다.
- 현재 실행 중인 모든 프로세스의 코드와 데이터, 파일 블록 등이 저장된다.
- 프로세스가 정상적으로 실행되려면 프로그램이 메모리에 load 되어야 한다.
- 주소가 할당된 일련의 바이트들로 구성되어 있다.
- CPU는 레지스터가 가리키는 주소로 메모리에 접근하여 다음에 수행할 명령어를 가져온다.
  - 필요한 데이터가 없으면 `MMU`를 통해 해당 데이터를 가져온다.

### MMU (Memory Management Unit, 메모리 관리 장치)
- 논리 주소를 물리 주소로 변환한다.
- 프로세스가 CPU에서 수행되면서 생성하는 모든 주소에 대해 base register를 더해주어 물리 주소로 변환한다.
- 메모리 보호나 캐시 관리 등 CPU가 메모리에 접근하는 것을 총 관리하는 하드웨어이다.
  - base register와 limit register를 이용하여 메모리를 보호한다.
  - base register : 접근할 수 있는 물리적 주소의 최솟값
  - limit register : 논리적 주소의 범위

### 메모리 주소
- 메모리는 오직 주소를 이용해서만 접근된다.
  - 논리 주소 : 프로세스마다 독립적으로 가지는 주소 공간
    - 각 프로세스마다 0번지부터 시작한다.
    - 프로세스 내에서 사용되는 코드와 데이터에 대한 주소이다.
  - 물리 주소 : 프로세스가 할당되는 하드웨어 메모리의 주소이다.
- 논리 주소가 물리 주소로 바뀌어 물리 메모리가 엑세스 된다.

### Address Binding
어떤 프로그램을 어떤 물리적 주소에 load 할 지 결정하는 과정이다. binding 하는 시점에 따라 분류된다.

#### 1. Compile Time
- 컴파일 시 프로세스의 물리적 주소가 정해진다.
- 메모리 내 프로세스 위치를 미리 알고 있다면, 컴파일러가 해당 위치에 고정된 주소를 생성한다.
- 논리적 주소와 물리적 주소가 동일하다.

#### 2. Load Time
- 메모리 내 프로세스의 위치를 알 수 없다면, 컴파일러는 `Relocatable Code`를 생성
  - Relocatable Code : 어느 위치에서나 수행 가능한 기계 언어 코드
- 프로세스를 메모리에 load하는 시점에 `Loader`가 물리적 주소를 결정한다.
- 논리적 주소와 물리적 주소가 다를 수 있다.

#### 3. Execution Time
- 프로세스가 실행되면서 메모리 주소를 동적으로 변경하는 방법.
- 런타임 시 물리적 주소가 결정된다.
- 런타임 주소 할당은 MMU라는 장치를 사용해서 논리 주소를 물리 주소로 바꾼다.

### 메모리 할당
- 메모리는 일반적으로 커널 영역과 사용자 프로세스 영역으로 나누어 사용한다.
- 사용자 프로세스 영역에 메모리를 할당하는 방법
  - Contiguous Allocation (연속적 할당) : 프로세스들이 연속적인 메모리 공간을 차지한다.
  - Noncontiguous Allocation (비연속적 할당) : 프로세스들이 고정 크기의 블록으로 나뉘어 메모리에 순서 상관 없이 저장된다.

#### 메모리 과할당
- 실제 메모리의 사이즈보다 더큰 사이즈의 메모리를 프로세스에 할당한 경우이다.
- 페이징 기법과 같은 메모리 관리로 사용자가 알지 못하도록 해야하지만, page fault가 발생하여 메모리에 페이지를 올려야 하는 경우에는 빈 프레임을 확보해야 한다.
  - page fault : 프로세스의 주소 공간에는 존재하지만 지금 컴퓨터의 실제 메모리에는 없는 데이터에 접근했을 경우에 발생.

### Swapping
- page fault 가 발생했을 때 메모리에서 당장 사용하지 않는 영역을 보조기억장치로 옮기고 
- 보조기억장치의 일부분을 마치 메모리처럼 불러와 쓰는 것을 Swapping이라 한다.
- 이를 통해 마치 페이지 폴트가 일어나지 않은 것처럼 만든다.
- Swap-in : 디스크에서 메모리로 이동
- Swap-out : 메모리에서 디스크로 이동